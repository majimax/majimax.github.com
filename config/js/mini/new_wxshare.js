(function(){function execHandler(handler){if(handler&&handler instanceof Object){var callback=handler.callback||null;var opts=handler.args||[];var context=handler.context||null;var delay=handler.delay||-1;if(callback&&callback instanceof Function){if(typeof(delay)=="number"&&delay>=0){setTimeout(function(){callback.call(context,opts)},delay)}else{callback.call(context,opts)}}}}function execAfterMergerHandler(handler,_args){if(handler&&handler instanceof Object){var args=handler.args||[];handler.args=_args.concat(args)}execHandler(handler)}document.addEventListener("WeixinJSBridgeReady",function(){window.G_WEIXIN_READY=true},false);function CallWeiXinAPI(fn,count){var total=2000;count=count||0;if(true===window.G_WEIXIN_READY||("WeixinJSBridge"in window)){fn.apply(null,[])}else{if(count<=total){setTimeout(function(){CallWeiXinAPI(fn,count++)},15)}}}window.WEIXIN_API=_api={Share:{"weibo":function(options,handler){CallWeiXinAPI(function(){WeixinJSBridge.on("menu:share:weibo",function(argv){WeixinJSBridge.invoke('shareWeibo',options,function(res){execAfterMergerHandler(handler,[res])})})})},"timeline":function(options,handler){CallWeiXinAPI(function(){WeixinJSBridge.on("menu:share:timeline",function(argv){WeixinJSBridge.invoke('shareTimeline',options,function(res){execAfterMergerHandler(handler,[res])})})})},"message":function(options,handler){CallWeiXinAPI(function(){WeixinJSBridge.on("menu:share:appmessage",function(argv){WeixinJSBridge.invoke('sendAppMessage',options,function(res){execAfterMergerHandler(handler,[res])})})})}},"setToolbar":function(visible,handler){CallWeiXinAPI(function(){if(true===visible){WeixinJSBridge.call('showToolbar')}else{WeixinJSBridge.call('hideToolbar')}execAfterMergerHandler(handler,[visible])})},"setOptionMenu":function(visible,handler){CallWeiXinAPI(function(){if(true===visible){WeixinJSBridge.call('showOptionMenu')}else{WeixinJSBridge.call('hideOptionMenu')}execAfterMergerHandler(handler,[visible])})},"pay":function(data,handlerMap){CallWeiXinAPI(function(){var requireData={"appId":"","timeStamp":"","nonceStr":"","package":"","signType":"","paySign":""};var map=handlerMap||{};var handler=null;var args=[data];for(var key in requireData){if(requireData.hasOwnProperty(key)){requireData[key]=data[key]||"";console.info(key+" = "+requireData[key])}}WeixinJSBridge.invoke('getBrandWCPayRequest',requireData,function(response){var key="get_brand_wcpay_request:";switch(response.err_msg){case key+"ok":handler=map.success;break;case key+"fail":handler=map.fail||map.error;break;case key+"cancel":handler=map.cancel||map.error;break;default:handler=map.error;break}execAfterMergerHandler(handler,args)})})}};var meta,metas=document.getElementsByTagName('meta');for(var i=0,len=metas.length;i<len;i++){if(metas[i].getAttribute('name')=='sharecontent'){meta=metas[i]}}if(!meta){return}var link=window.location.href;var opt_msg={"img_url":meta.dataset.msgImg||"http://"+window.location.host+document.getElementsByTagName('img')[0].getAttribute('src'),"link":link,"desc":meta.dataset.msgContent||document.title+'，敬请访问！',"title":meta.dataset.msgTitle||document.title};var handler_msg={"urlCall":meta.dataset.msgCallback||'',callback:function(res){if(res[0].err_msg.indexOf('cancel')==-1){if(window.BI_weixin){opt_msg.link=BI_weixin.save_openid_uid(opt_msg);BI_weixin.wxcallback(opt_msg)}else{if(handler_line.urlCall){window.location.href=handler_msg.urlCall}}}}};var opt_line={"img_url":meta.dataset.lineImg||"http://"+window.location.host+document.getElementsByTagName('img')[0].getAttribute('src'),"link":link,"desc":meta.dataset.lineTitle||document.title;"title":meta.dataset.lineTitle||document.title};var handler_line={"urlCall":meta.dataset.lineCallback||'',callback:function(res){if(res[0].err_msg.indexOf('cancel')==-1){if(window.BI_weixin){opt_line.link=BI_weixin.save_openid_uid(opt_line);BI_weixin.wxcallback(opt_line)}else{if(handler_line.urlCall){window.location.href=handler_msg.urlCall}}}}}_api.Share.message(opt_msg,handler_msg);_api.Share.timeline(opt_line,handler_line)})();